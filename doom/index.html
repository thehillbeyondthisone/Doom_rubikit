<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>RubiKitOS · DOOM Runner</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Fira+Code:wght@400;600&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="style.css"/>
</head>
<body class="rk">
  <!-- Header -->
  <header class="rk-header">
    <div class="rk-title">
      <img src="icon.svg" alt="" class="rk-icon">
      <div>
        <h1>DOOM Runner</h1>
        <p class="rk-sub">Pick once, then just hit Power.</p>
      </div>
    </div>
    <div class="rk-actions">
      <button id="btnSettings" class="btn ghost" title="Settings">⚙️</button>
      <div class="rk-sep"></div>
      <button id="btnPower" class="btn">⏻ Power</button>
      <button id="btnFullscreen" class="btn ghost">Fullscreen</button>
    </div>
  </header>

  <!-- Main -->
  <main class="rk-main">
    <!-- Collapsible Settings Drawer -->
    <aside id="settings" class="drawer">
      <div class="drawer-head">
        <h3>Settings</h3>
        <button id="btnCloseSettings" class="icon">✕</button>
      </div>
      <div class="drawer-body">

        <!-- Theme -->
        <div class="form-row">
          <label>Theme</label>
          <div class="chips">
            <button class="chip" data-theme="notum-blue">Notum Blue</button>
            <button class="chip" data-theme="onyx">Onyx</button>
            <button class="chip" data-theme="monokai">Monokai</button>
          </div>
        </div>

        <!-- Engine port -->
        <div class="form-row">
          <label>Engine Port</label>
          <input id="portPath" type="text" value="engine/ports/jsdos/index.html"/>
          <small>Default is js-dos. This page will receive the EXE/WAD and auto-run.</small>
        </div>

        <!-- Folder picker -->
        <div class="form-row">
          <label>Game Folder</label>
          <div class="row">
            <button id="btnPickFolder" class="btn ghost sm">Pick Folder</button>
            <input id="inputDir" type="file" webkitdirectory directory multiple style="display:none"/>
            <span id="folderStatus" class="muted">No folder selected</span>
          </div>
          <small>We’ll recursively scan this folder for DOS EXEs and WADs. If supported, we’ll remember this permission.</small>
        </div>

        <!-- EXE select -->
        <div class="form-row">
          <label>Detected EXEs</label>
          <select id="exeSelect"></select>
          <small>Common: <code>DOOM.EXE</code>, <code>DOOM2.EXE</code>. Pick your default.</small>
        </div>

        <!-- WAD select -->
        <div class="form-row">
          <label>Detected WADs</label>
          <select id="wadSelect"></select>
          <small>We’ll upload the IWAD into the emulator FS as <code>DOOM.WAD</code> for maximum compatibility.</small>
        </div>

        <!-- Autostart -->
        <div class="form-row">
          <label>Autostart</label>
          <label class="toggle">
            <input id="autostart" type="checkbox" checked/>
            <span>Open engine & auto-run with saved EXE/WAD when this module loads</span>
          </label>
        </div>

        <!-- Actions -->
        <div class="form-row">
          <label>Actions</label>
          <div class="row">
            <button id="btnRescan" class="btn ghost sm">Rescan Folder</button>
            <button id="btnTestStart" class="btn ghost sm">Test Start</button>
            <button id="btnOpenEngineIndex" class="btn ghost sm">Open Engine Index</button>
          </div>
        </div>

      </div>
    </aside>

    <!-- Stage -->
    <section class="rk-stage">
      <div id="help" class="card help">
        <h2>Quick start</h2>
        <ol>
          <li>Open <b>Settings</b> (⚙️) → <b>Pick Folder</b> containing your DOS <b>DOOM.EXE</b> and a <b>WAD</b>.</li>
          <li>Choose your preferred EXE/WAD from the detected lists.</li>
          <li>Hit <b>⏻ Power</b>. From now on, just use Power.</li>
        </ol>
        <p class="muted">We pipe the EXE/WAD to the js-dos port automatically via secure messaging and run it for you.</p>
      </div>

      <div class="engine-host">
        <iframe id="frame" class="engine-frame" title="DOOM Port" sandbox="allow-scripts allow-same-origin allow-pointer-lock"></iframe>
      </div>
    </section>
  </main>

  <!-- Logic -->
  <script src="module.js"></script>
</body>
</html>
